version: '3'

services:

    ## Reverse Proxy # # # # # # # # # # # # # # #

    nginx-proxy:
        image: jwilder/nginx-proxy:latest
        ports:
            - ${HTTP_BIND_PORT}:80
            - ${HTTPS_BIND_PORT}:443
        volumes:
            - /var/run/docker.sock:/tmp/docker.sock:ro
            - ./docker-compose.d/certs:/etc/nginx/certs


    ## php5.6  # # # # # # # # # # # #
    php56:
        build:
            context: ./DependentFiles/php56
            dockerfile: php56Dockerfile
        hostname: php56.ozn-form
        environment:
            VIRTUAL_HOST: php56.ozn-form.com
            CERT_NAME: ${LOCAL_DOMAIN}
            APACHE_LOG_DIR: "/var/log/apache2"
            TZ: "Asia/Tokyo"
        volumes:
            - ./DependentFiles/php56/sites-available:/etc/apache2/sites-available
            - ./DependentFiles/php56/xdebug.ini:/usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini
            - ./DependentFiles/php56/php.ini:/usr/local/etc/php/php.ini
            - ./docker-compose.d/certs:/root/keys
            - ../:/var/www/html


    ## php7.1  # # # # # # # # # # # # # # # #
    php71:
        build:
            context: ./DependentFiles/php7x
            dockerfile: php71Dockerfile
        hostname: php71.ozn-form
        environment:
            VIRTUAL_HOST: php71.ozn-form.com
            CERT_NAME: ${LOCAL_DOMAIN}
            APACHE_LOG_DIR: "/var/log/apache2"
            TZ: "Asia/Tokyo"

        volumes:
            - ./DependentFiles/php7x/sites-available:/etc/apache2/sites-available
            - ./DependentFiles/php7x/xdebug.ini:/usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini
            - ./docker-compose.d/certs:/root/keys
            - ../:/var/www/html


    ## php7.3  # # # # # # # # # # # # # # # #
    php73:
        build:
            context: ./DependentFiles/php7x
            dockerfile: php73Dockerfile
        hostname: php73.ozn-form
        environment:
            VIRTUAL_HOST: php73.ozn-form.com
            CERT_NAME: ${LOCAL_DOMAIN}
            APACHE_LOG_DIR: "/var/log/apache2"
            TZ: "Asia/Tokyo"

        volumes:
            - ./DependentFiles/php7x/sites-available:/etc/apache2/sites-available
            - ./DependentFiles/php7x/xdebug.ini:/usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini
            - ./docker-compose.d/certs:/root/keys
            - ../:/var/www/html

    ##  テスト用 SMTP サーバー  # # # # # # # # # # # # # # # #
    mailhog:
        image: mailhog/mailhog
        ports:
            - "1025:1025"
            - "8025:8025"
